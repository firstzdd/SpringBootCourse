## 9.1 JMS简介

JMS（Java Messaging Service，Java消息服务）是Java平台上有关面向消息中间件(MOM)的技术规范，它便于消息系统中的Java应用程序进行消息交换，并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发。

MQ全称为Message Queue，消息队列（MQ）是一种应用程序对应用程序的通信方法。应用程序通过写和检索出入列队的针对应用程序的数据（消息）来通信，而无需专用连接来链接它们。消息传递指的是程序之间通过在消息中发送数据进行通信，而不是通过直接调用彼此来通信，直接调用通常是用于诸如远程过程调用的技术。

JMS是一个用于提供消息服务的技术规范，它制定了在整个消息服务提供过程中的所有数据结构和交互流程。而MQ则是消息队列服务，是面向消息中间件（MOM）的最终实现，是真正的服务提供者；MQ的实现可以基于JMS，也可以基于其他规范或标准。

MQ的消费-生产者模型的一个典型的代表，一端往消息队列中不断的写入消息，而另一端则可以读取或者订阅队列中的消息。MQ和JMS类似，但不同的是JMS是SUN Java消息中间件服务的一个标准和API定义，而MQ则是遵循了AMQP协议的具体实现和产品。

在项目中，将一些无需即时返回且耗时的操作提取出来，进行了异步处理，而这种异步处理的方式大大的节省了服务器的请求响应时间，从而提高了系统的吞吐量。

JMS中的一些术语：

1. Provider(MessageProvider)：生产者，指消息的生产者，发送消息的程序。

2. Consumer(MessageConsumer)：消费者，指消息的消费者，接收消息的程序。

3. P2P：Point to Point，即点对点的消息模型。

  ![image-20191203095127691](images/image-20191203095127691.png)

4. Pub/Sub：publish/Subscribe，即发布/订阅的消息模型。
    ![image-20191203094306720](images/image-20191203094306720.png)
5. Queue：队列，在消息的传输过程中保存消息的容器。
6. Topic：主题。消息的发布者将消息发布到一个内容节点，消息的订阅者在这个内容节点订阅（接收）消息，这个内容节点就是主题。主题使得消息的发布者和订阅者保持相互独立。
7. ConnectionFactory：连接工厂，JMS用来创建连接的工厂（一种常见的设计模式：工厂模式）。
8. Connection：JMS客户端到JMS Provider的连接。
9. Destination：消息的目的地。
10. Session：会话，一个发送或者接受消息的线程。



JMS规范的两种消息传输方式Topic（一对多）和Queue（一对一），比较如下：

| 比较项         | Topic                                                        | Queue                                                        |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 概要           | Publish Subscribe messaging 发布订阅消息                     | Point-to-Point 点对点                                        |
| 有无状态       | 数据默认不落地，是无状态的                                   | 数据默认会在mq服务器上以文件形式保存，比如Active MQ一般保存在$AMQ_HOME\data\kr-store\data下面。也可以配置成DB存储 |
| 完整性保障     | 并不保证publisher发布的每条数据，Subscriber都能接受到        | 保证每条数据都能被receiver接收                               |
| 消息是否会丢失 | 一般来说publisher发布消息到某一个topic时，只有正在监听该topic地址的sub能够接收到消息；如果没有sub在监听，该topic就丢失了 | Sender发送消息到目标Queue，receiver可以异步接收这个Queue上的消息。Queue上的消息如果暂时没有receiver来取，也不会丢失 |
| 发布接收策略   | 一对多的消息发布接收策略，监听同一个topic地址的多个sub都能收到publisher发送的消息。Sub接收完通知mq服务器 | 一对一的消息发布接收策略，一个sender发送的消息，只能有一个receiver接收。receiver接收完后，通知mq服务器已接收，mq服务器对queue里的消息采取删除或其他操作 |

消息队列集群包括两种，普通模式和镜像模式：

- 普通模式是每个节点存相同的元数据，只有一个存真正的数据实体，当消费者从某个没有数据实体的节点读数据时，需要临时在节点间传输数据。
- 镜像模式：消费队列为镜像队列，实现了消息队列的高可用，但是占用大量网络带宽同步镜像队列中的数据。







